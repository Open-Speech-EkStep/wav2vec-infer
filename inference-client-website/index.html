<!doctype html>
<html>

<head>
    <title>Speech Recognition Models</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <link href="bootstrap/css/bootstrap.min.css" rel="stylesheet">
    <script src="hark.bundle.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/3.1.1/socket.io.js"
            integrity="sha512-oFOCo2/3DtjrJG4N27BjSLQWoiBv171sK6a+JiWjp/7agxC2nCUP358AqzxkBUb5jX8g6CYLPdSKQTbC0weCwA=="
            crossorigin="anonymous"></script>
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"
            integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
    <script src="bootstrap/js/bootstrap.bundle.min.js"></script>
    <script src="platform.js"></script>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css"
          integrity="sha384-wvfXpqpZZVQGK6TAh5PVlGOfQNHSoD2xbE+QkPxCAFlNEevoEH3Sl0sibVcOQVnN" crossorigin="anonymous">
    <link rel="stylesheet" href="//netdna.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css">
    <style>
        textarea {
            width: 100%;
            padding: 12px;
            border: 1px solid #ccc;
            border-radius: 4px;
            resize: vertical;
        }

        :required {
            background: #00b300;
        }

        div.stars {
            width: 270px;
            display: inline-block;
        }

        input.star {
            display: none;

        }

        select.feedback {
            display: none;
        }

        label.star {
            position: relative;
            right: 35%;
            float: right;
            padding: 10px;
            font-size: 35px;
            color: #444;
            transition: all .2s;
        }

        input.star:checked ~ label.star:before {
            content: '\f005';
            color: #00b300;
            transition: all .25s;
        }

        input.star-5:checked ~ label.star:before {
            color: #00b300;
            text-shadow: 0 0 20px #952;
        }

        input.star-1:checked ~ label.star:before {
            color: #F62;
        }

        label.star:hover {
            transform: rotate(-15deg) scale(1.3);
        }

        label.star:before {
            content: '\f006';
            font-family: FontAwesome;
        }

        ::-webkit-input-placeholder {
            /* Chrome/Opera/Safari */
            text-align: center;
        }

        ::-moz-placeholder {
            text-align: center;
        }

        ::-ms-placeholder {
            text-align: center;
        }

        #mic_image:hover {
            border-radius: 70%;
            box-shadow: 0 0 14px 8px rgba(33, 33, 33, .2);
        }

        .row {
            padding: 15px;
            margin: 15px;
            border: 1px black solid;
        }

        .rating {
            display: inline-block;
            width: 100%;
            text-align: center;
        }

        .feedback {
            display: inline-block;
            width: 100%;
            text-align: center;
        }

        #like,
        #dislike {
            display: inline-block;
            cursor: pointer;
            margin: 10px;
        }

        #dislike:hover,
        #like:hover {
            color: #2EBDD1;
            transition: all .2s ease-in-out;
            transform: scale(1.1);
        }

        .active {
            color: #2EBDD1;
        }

        #status_text {
            margin-top: 10px;
        }

        #loader {
            margin-top: 20px;
            border: 4px solid #f3f3f3;
            border-radius: 50%;
            border-top: 4px solid #3498db;
            width: 30px;
            height: 30px;
            -webkit-animation: spin 2s linear infinite;
            /* Safari */
            animation: spin 2s linear infinite;
        }

        /* Safari */
        @-webkit-keyframes spin {
            0% {
                -webkit-transform: rotate(0deg);
            }

            100% {
                -webkit-transform: rotate(360deg);
            }
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }
    </style>
</head>

<body>
<nav class="navbar navbar-expand-lg navbar-light bg-light px-4">
    <a href="https://vakyansh.in">
        <img src="ekstep-logo.svg" style="width:3rem" alt="Ek Step Logo">
    </a>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation"><span
            class="navbar-toggler-icon"></span></button>
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
        <ul class="navbar-nav ml-auto">
            <li class="nav-item p-2 dropdown"><a href="https://inference.vakyansh.in/"
                                                 class="nav-link text-dark font-weight-bold dropdown-toggle"
                                                 id="dropdownMenuButton"
                                                 data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Speech
                Recognition Models </a>
                <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
                    <a class="dropdown-item" href="https://codmento.com/ekstep/test/kannada">Kannada</a>
                    <a class="dropdown-item" href="https://codmento.com/ekstep/test/hindi">Hindi</a>
                    <a class="dropdown-item" href="https://codmento.com/ekstep/test/english">English</a>
                    <a class="dropdown-item"
                       href="https://codmento.com/ekstep/test/indian-english">Indian-English</a>
                    <a class="dropdown-item" href="https://codmento.com/ekstep/test/telugu">Telugu</a>
                    <a class="dropdown-item" href="https://codmento.com/ekstep/test/tamil">Tamil</a>
                </div>
            </li>
            <li class="nav-item p-2"><a href="https://vakyansh.in/about-us"
                                        class="nav-link text-dark font-weight-bold">About Us</a>
            </li>
            <li class="nav-item p-2"><a href="https://vakyansh.in/"
                                        class="nav-link text-dark font-weight-bold">Vakyansh</a></li>
            <li class="nav-item p-2"><a class="nav-link text-dark font-weight-bold d-none" id="nav-user"><span
                    class="material-icons align-middle mx-1">account_circle</span> <span
                    id="nav-username"></span></a></li>
        </ul>
    </div>
</nav>
<center>
    <div class="container">
        <div class="row" style="border: 0px;">
            <div class="col-sm-12">
                <center>
                    <h4 id="title-text">Speech Recognition Models</h4>
                    <br/>
                    <h6 id="userid"></h6>
                </center>
            </div>
        </div>
        <div class="row">
            <div class="col-sm-12">
                <br/>
                <div style="min-height:100px;min-width:100px;">
                    <center>
                        <img src="mic.png" id="mic_image" onclick="toggle()" height="100" width="100"
                             alt="MIC"/><br/>
                        <p id="status_text" style="display: none;">Starting</p>
                    </center>
                </div>
            </div>
            <div class="col-sm-12">
                <br/>
            </div>
            <div class="col-sm-12 col-md-12">
                <center>
                    <audio controls id="audio_sample_id" style="display: none;">
                        <source src="hindi.m4a" id="sample_id"/>
                    </audio>
                </center>
            </div>
            <div class="col-sm-12">
                <textarea id="output" placeholder="Output" rows="6" readonly></textarea>
            </div>
        </div>
        <div class="row">
            <div class="col-sm-12">
                <h5>Please do provide your rating(5 being the highest)</h5>
                <div class="rating">
                    <!--                                             Thumbs up-->
                    <!--                                            <div id="like" class="grow" data-val="thumbs_up">-->
                    <!--                                                <i class="fa fa-thumbs-up fa-3x like" aria-hidden="true"></i>-->
                    <!--                                            </div>-->
                    <!--                                            &lt;!&ndash; Thumbs down &ndash;&gt;-->
                    <!--                                            <div id="dislike" class="dislike grow" data-val="thumbs_down">-->
                    <!--                                                <i class="fa fa-thumbs-down fa-3x like" aria-hidden="true"></i>-->
                    <!--                                            </div>-->
                    <form id="feedback-form">
                            <input class="star star-5" id="star-5" type="radio" name="star" value="5">
                            <label class="star star-5" for="star-5"></label>
                            <input class="star star-4" id="star-4" type="radio" name="star" value="4">
                            <label class="star star-4" for="star-4"></label>
                            <input class="star star-3" id="star-3" type="radio" name="star" value="3">
                            <label class="star star-3" for="star-3"></label>
                            <input class="star star-2" id="star-2" type="radio" name="star" value="2">
                            <label class="star star-2" for="star-2"></label>
                            <input class="star star-1" id="star-1" type="radio" name="star" value="1" required>
                            <label class="star star-1" for="star-1"></label>
                            <!--                <div class="feedback">-->
                        <div class="feedback">
                            <label for="feedback-dropdown">Provide Feedback</label>
                            <select id="feedback-dropdown" required>
                                <option value=""> -- select an option --</option>
                                <option value="looks_perfect">Looks perfect</option>
                                <option value="few_words_missing">Few words missing</option>
                                <option value="few_words_misspelled">Few words misspelled</option>
                            </select>
                            <input id="Submit" class="SubmitButton" type="submit" name="SUBMITBUTTON" value="Submit"
                                   style="font-size:20px; "/>
                        </div>
                    </form>
                </div>

                <center>
                    <div id="loader" style='display: none;'></div>
                </center>
                <p id="rating-note">(Rating will be enabled only after you speak in the microphone)</p>
            </div>
        </div>
        <div class="row">
            <center>
                <h4>Vakyansh: The Home of Speech Recognition Essentials for Indian Languages</h4><br/>
                <p>Vakyansh aims to host the key essentials of Automatic Speech Recognition
                    (ASR) technology, focusing on
                    Indian languages. It is a resource that allows people to build applications that leverage speech
                    recognition. <a href="https://vakyansh.in/about-us">Know More</a></p>
            </center>
        </div>
    </div>
</center>
<footer class="bottom bg-light pt-3 border-top mt-lg-2 w-100">
    <div class="container-fluid">
        <div
                class="d-flex flex-column-reverse flex-lg-row justify-content-lg-around align-items-sm-center align-items-md-center text-center">
            <div class="">
                <p class="text-muted">&copy; EkStep Foundation, 2020 .</p>
            </div>
            <div class="d-lg-inline-flex justify-content-around mb-2">
                <div class="p-2"><a href="https://vakyansh.in/about-us">About Us</a></div>
                <div class="p-2"><a href="https://vakyansh.in/terms-and-conditions">Terms & Conditions</a></div>
                <div class="p-2"><a href="https://vakyansh.in/terms-and-conditions#privacy-policy">Privacy
                    Policy</a></div>
            </div>
        </div>
    </div>
</footer>

<script>
    /*
        init variables
    */
    let socket, socket_close_timeout = null;
    let current_lang = 'en', selected_lang = 'en';
    let bufferSize = 16384;
    let sentOnce = true;
    let state = "OFF";
    let speechEvents = null;
    let input, processor, context, globalStream, audioContextClass;
    let localBuffer = null, isSpeaking = false;
    let timeout_ = null, state_end = false, audioData = [], recordingLength = 0, sampleRate = 44100,
        socket_disconnect_timeout = null;
    let userId = null, recordedBlob = null, rating = null, feedback = null, device = null, browser = null,
        transcription_text = null,
        transcription_language = null, end_timeout = null;
    let nAgt = navigator.userAgent, verOffset;
</script>
<script>
    /*
        utilities
    */
    function fetchCurrentLanguageCode(language) {
        language = language.toLowerCase();
        if (language === "kannada") {
            return "kn";
        } else if (language === "indian-english") {
            return "en-IN";
        } else if (language === "hindi") {
            return "hi";
        } else if (language === "tamil") {
            return "ta";
        } else if (language === "telugu") {
            return "te";
        } else if (language === "gujarati") {
            return "gu";
        } else {
            return "en";
        }
    }

    function toCamelCase(word) {
        return word.charAt(0).toUpperCase() + word.slice(1).toLowerCase()
    }

    function getDeviceInfo() {
        const os = platform.os;
        let info = os.family + " " + os.version;
        if (platform.product) {
            info = info + " " + platform.product;
        }
        return info;
    }

    function getBrowserInfo() {
        let info = platform.name + " " + platform.version;
        return info;
    }


    function timeout(timeLimit, funcToCall) {
        let timeout = setTimeout(function () {
            funcToCall()
        }, timeLimit);
        return timeout;
    }

    function disableAutoMicClose() {
        if (timeout_ !== null) {
            clearTimeout(timeout_)
            timeout_ = null;
        }
    }

    function enableAutoMicClose(callbackFunction) {
        timeout_ = timeout(120000, callbackFunction);
    }

    function enableDelaySocketClose() {
        end_timeout = setTimeout(() => {
            endSocket();
            end_timeout = null;
        }, 4000);
    }

    function disableDelaySocketClose() {
        if (end_timeout !== null || end_timeout) {
            clearTimeout(end_timeout);
            end_timeout = null;
            endSocket();
        }
    }

    function enableSocketClose() {
        if (socket_close_timeout === null) {
            socket_close_timeout = setTimeout(() => {
                if (state === "OFF")
                    endSocket();
                socket_close_timeout = null;
            }, 60000);
        }
    }

    // function disableSocketClose() {
    //     if (socket_close_timeout !== null) {
    //         clearTimeout(socket_close_timeout);
    //         socket_close_timeout = null;
    //     }
    // }
</script>
<script>
    /*
        audio manipulation
    */
    function downSampleBuffer(buffer, sampleRate, outSampleRate) {
        if (outSampleRate == sampleRate) {
            return buffer;
        }
        if (outSampleRate > sampleRate) {
            throw "down-sampling rate show be smaller than original sample rate";
        }
        var sampleRateRatio = sampleRate / outSampleRate;
        var newLength = Math.round(buffer.length / sampleRateRatio);
        var result = new Int16Array(newLength);
        var offsetResult = 0;
        var offsetBuffer = 0;
        while (offsetResult < result.length) {
            var nextOffsetBuffer = Math.round((offsetResult + 1) * sampleRateRatio);
            var accum = 0, count = 0;
            for (var i = offsetBuffer; i < nextOffsetBuffer && i < buffer.length; i++) {
                accum += buffer[i];
                count++;
            }

            result[offsetResult] = Math.min(1, accum / count) * 0x7FFF;
            offsetResult++;
            offsetBuffer = nextOffsetBuffer;
        }
        return result.buffer;
    }

    function appendBuffer(buffer1, buffer2) {
        const buffer = new ArrayBuffer(buffer1.byteLength + buffer2.byteLength);
        let tmp = new Uint8Array(buffer);
        tmp.set(new Uint8Array(buffer1), 0);
        tmp.set(new Uint8Array(buffer2), buffer1.byteLength);
        return buffer;
    };

    function flattenArray(channelBuffer, recordingLength) {
        let result = new Float32Array(recordingLength);
        let offset = 0;
        for (let i = 0; i < channelBuffer.length; i++) {
            let buffer = channelBuffer[i];
            result.set(buffer, offset);
            offset += buffer.length;
        }
        return result;
    }

    function writeUTFBytes(view, offset, string) {
        for (var i = 0; i < string.length; i++) {
            view.setUint8(offset + i, string.charCodeAt(i));
        }
    }

    function generateWavBlob(finalBuffer) {
        let buffer = new ArrayBuffer(44 + finalBuffer.length * 2);
        let view = new DataView(buffer);

        // RIFF chunk descriptor
        writeUTFBytes(view, 0, 'RIFF');
        view.setUint32(4, 44 + finalBuffer.length * 2, true);
        writeUTFBytes(view, 8, 'WAVE');
        // FMT sub-chunk
        writeUTFBytes(view, 12, 'fmt ');
        view.setUint32(16, 16, true); // chunkSize
        view.setUint16(20, 1, true); // wFormatTag
        view.setUint16(22, 1, true); // wChannels:mono(1 channel) / stereo (2 channels)
        view.setUint32(24, sampleRate, true); // dwSamplesPerSec
        view.setUint32(28, sampleRate * 2, true); // dwAvgBytesPerSec
        view.setUint16(32, 4, true); // wBlockAlign
        view.setUint16(34, 16, true); // wBitsPerSample
        // data sub-chunk
        writeUTFBytes(view, 36, 'data');
        view.setUint32(40, finalBuffer.length * 2, true);

        // write the PCM samples
        let index = 44;
        let volume = 1;
        for (var i = 0; i < finalBuffer.length; i++) {
            view.setInt16(index, finalBuffer[i] * (0x7FFF * volume), true);
            index += 2;
        }

        // our final blob
        let blob = new Blob([view], {type: 'audio/wav'});
        return blob;
    }
</script>
<script>
    /*
        UI interactions
    */
    function enableRating(flag) {
        let value = flag ? 'auto' : 'none'
        let select_value = flag ? false : true
        $('select').prop("disabled", select_value)
        $('input[type=submit]').attr("disabled", select_value)
        $('input.star').css({'pointer-events': value})
        $('label.star').css({'pointer-events': value})
        $('#like').css({'pointer-events': value})
        $('#dislike').css({'pointer-events': value})
        if (flag) {
            $('#rating-note').hide();
        } else {
            $('#rating-note').show();
        }
    }

    function connectSocket(startMic) {
        const socketIO = io({path:'/ekstep/test/socket.io',autoConnect: false});
        socketIO.connect();
        socket = socketIO.on('connect', function () {
            userId = socket.id;
        });
        socket.on('connect-success', function (data) {
            console.log("connect-success", userId);
            startMic();
            document.getElementById('userid').innerHTML = "";
        });
        socket.on('response', function (data, language) {
            if (language === "en-IN") data = data.toLowerCase();
            document.getElementById('output').textContent = data;
            transcription_text = data;
            transcription_language = language;
        });
        socket.on('disconnect', function () {
            console.log("disconnected");
        })
        socket.on('terminate', function () {
            if (socket_close_timeout === null) {
                endSocket();
                console.log("end socket called");
            }
        });
        socket.on('abort', function () {
            alert("The server is busy at the moment, please try after sometime.");
            // $(".rating **").attr("disabled", "disabled").off('click');
            enableRating(true);
            // stopRecording();
            document.getElementById('userid').innerHTML = "Server busy. Please try again after some time.";
        });
    }

    function uiOnMicStart() {
        let image = document.getElementById("mic_image");
        image.src = "stop.png";
        image.addEventListener('load', function () {
            $('#status_text').text("Start Speaking !");
        })
        $('.active').removeClass('active');
        enableRating(true);
        document.getElementById('output').textContent = "";
        $('#audio_sample_id').hide();
    }

    function uiOnMicStop() {
        if ((verOffset = nAgt.indexOf("Firefox")) != -1) {
            $('#mic_image').animate({
                'top': '10%',
                'left': '10%',
                'right': '10%',
                'bottom': '10%',
                'height': '100px',
                'width': '100px'
            });
        } else {
            $("#mic_image").animate({zoom: '100%'});
        }
        // setTimeout(() => {
        let image = document.getElementById("mic_image");
        image.src = "mic.png";
        // }, 1000);
        $('#audio_sample_id').show();
    }

    function stateOnMicStart() {
        state = "ON";
        selected_lang = current_lang;
        audioData = [];
        recordingLength = 0;
        enableAutoMicClose(stopRecording);
    }

    function stateOnMicStop() {
        state = "OFF";
        socket.emit('mic_data', null, current_lang, false, true);
    }

    function toggle() {
        // disableDelaySocketClose();
        // if (socket && socket !== null) {
        //     if (socket.connected)
        //         endSocket();
        // }
        let audio = new Audio("click_sound.wav ");
        $('input[type="radio"]').prop('checked', false);
        $('#feedback-dropdown option').prop('selected', function () {
            return this.defaultSelected;
        });
        if (state === "OFF") {
            if ((verOffset = nAgt.indexOf("Firefox")) != -1) {
                $('#mic_image').animate({
                    'top': '10%',
                    'left': '10%',
                    'right': '10%',
                    'bottom': '10%',
                    'height': '87px',
                    'width': '87px'
                }, "slow");
            } else {
                $("#mic_image").animate({zoom: '87%'}, "slow");
            }
            audio.play();
            if (socket && socket !== null && socket.connected) {
                startRecording();
            } else {
                connectSocket(startRecording);
            }
            $('#status_text').show();
            $('#status_text').text("Starting...");
        } else if (state === "ON") {
            stopRecording();
            audio.play();
            $('#status_text').hide();
        }
    }

    function setSilenceDetector(audioStream, context) {
        let options = {audioContext: context};
        speechEvents = hark(audioStream, options);

        speechEvents.on('speaking', function () {
            isSpeaking = true;
            // console.log('speaking');
        });

        speechEvents.on('stopped_speaking', function () {
            // console.log('stopped_speaking');
            isSpeaking = false;
        });
    }

    function streamAudioProcess(e) {
        audioData.push(new Float32Array(e.inputBuffer.getChannelData(0)));
        recordingLength += bufferSize;
        var data_44100 = e.inputBuffer.getChannelData(0);
        // let data_16000 = data_44100;
        var data_16000 = downSampleBuffer(data_44100, 44100, 16000);
        if (isSpeaking) {
            sentOnce = false;

            if (localBuffer !== undefined && localBuffer !== null) {
                data_16000 = appendBuffer(localBuffer, data_16000)
            }
            // console.log("emitted", data_16000);
            socket.emit('mic_data', data_16000, current_lang, true, false);
            localBuffer = null;
        } else {
            if (!sentOnce) {
                sentOnce = true;
                socket.emit('mic_data', data_16000, current_lang, false, false);
                // console.log("emitted last");
            } else {
                localBuffer = data_16000;
            }
        }
    };

    function startRecording() {
        uiOnMicStart();
        stateOnMicStart();
        enableSocketClose();
        let constraints = {audio: true, video: false}
        let sendData = false;

        navigator.mediaDevices.getUserMedia(constraints).then(function (stream) {
            audioContextClass = window.AudioContext || window.webkitAudioContext;

            context = new audioContextClass({
                latencyHint: 'interactive',
            });

            setSilenceDetector(stream.clone(), context);

            input = context.createMediaStreamSource(stream);
            processor = context.createScriptProcessor(bufferSize, 1, 1);

            input.connect(processor);
            processor.connect(context.destination);

            processor.onaudioprocess = streamAudioProcess;
        }).catch(function (err) {
            console.log(err);
            stopRecording();
        });
    }

    function endSocket() {
        socket.disconnect();
    }

    function stopRecording() {
        disableAutoMicClose();
        uiOnMicStop();
        stateOnMicStop();
        stopMediaRecorder();
        // enableDelaySocketClose();
    }

    function stopMediaRecorder() {
        speechEvents.stop();
        input.disconnect();
        processor.disconnect();

        let finalBuffer = flattenArray(audioData, recordingLength);
        let blob = generateWavBlob(finalBuffer);
        if (blob == null) {
            console.log("no blob generated");
            return;
        }
        recordedBlob = blob;
        let url = window.URL.createObjectURL(blob);
        document.getElementById("sample_id").src = url;
        document.getElementById("audio_sample_id").load();
    }


</script>
<script>
    /*
    Store to db related code
    */

    function saveRating(bodyParams, enableRating) {
        const {recordedBlob, rating, feedback, device, browser, transcription_text, transcription_language, userId} = bodyParams;
        const formData = new FormData();
        formData.append('audio_data', recordedBlob);
        formData.append('rating', rating);
        formData.append('feedback', feedback);
        formData.append('device', device);
        formData.append('browser', browser);
        formData.append('text', transcription_text);
        formData.append('language', transcription_language);
        formData.append('user_id', userId);

        $.ajax({
            type: 'POST',
            url: 'api/feedback',
            data: formData,
            processData: false,
            contentType: false,
            beforeSend: function () {
                $("#loader").show();
            },
            success: function (data, textStatus, jqXHR) {
                $("#loader").hide();
            },
            error: function (jqXHR, textStatus, errorThrown) {
                $("#loader").hide();
                alert("Rating update failed, Please try again")
                enableRating(true)
            }
        });
    }
</script>
<script>
    /*
        on document loaded event
    */
    $(document).ready(function () {
        let pathname = window.location.pathname.replace("/ekstep/test", "").replace("/", "");
        if (pathname.length != 0) {
            current_lang = fetchCurrentLanguageCode(pathname);
            let titleLanguage = toCamelCase(pathname);
            if (pathname === "indian-english")
                titleLanguage = "English(IN)";
            document.getElementById("title-text").innerHTML = titleLanguage + " Speech Recognition Model"
        }

        device = getDeviceInfo();
        browser = getBrowserInfo();
        $('#feedback-form').on('submit', function () {
            event.preventDefault();
            $('.active').removeClass('active');
            $(this).addClass('active');
            stopRecording();
            rating = $('[name="star"]:checked').val();
            feedback = $("#feedback-dropdown").val();
            enableRating(false)
            saveRating({
                recordedBlob,
                rating,
                feedback,
                device,
                browser,
                transcription_text,
                transcription_language,
                userId
            }, enableRating);
        });
        enableRating(false);
    });
</script>
</body>

</html>
